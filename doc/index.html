<!doctype html>
<html lang="en">
  <!--
  Documentation for MIDA - minimalistic language for generation of MIDI
  files.
  
  Copyright (c) 2014 Mark Karpov
  
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.3 or any
  later version published by the Free Software Foundation; with no Invariant
  Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the
  license is included in the section entitled "GNU Free Documentation
  License".  -->
  <head>
    <meta charset="utf-8">
    <meta name="description"    content="MIDA Manual">
    <meta name="author"         content="Mark Karpov">
    <meta name="dcterms.rights" content="(c) 2014 Mark Karpov">
    <meta name="keywords"       content="generative music, midi">
    <title>MIDA Manual</title>
    <link href="ascetic.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <h1>MIDA</h1>
    <h2 id="0">Table of Contents</h2>
    <ul class="no-bullet">
      <li><a href="#1">1 What is MIDA?</a></li>
      <li><a href="#2">2 Installation</a>
        <ul class="no-bullet">
          <li><a href="#2.1">2.1 Windows</a></li>
          <li><a href="#2.2">2.2 GNU/Linux</a></li>
          <li><a href="#2.3">2.3 Compilation from Source</a></li>
      </ul></li>
      <li><a href="#3">3 Invocation</a></li>
      <li><a href="#4">4 Configuration File</a></li>
      <li><a href="#5">5 MIDA Tutorial</a>
        <ul class="no-bullet">
          <li><a href="#5.1">5.1 Literal Values</a>
            <ul class="no-bullet">
              <li><a href="#5.1.1">5.1.1 Duration</a></li>
              <li><a href="#5.1.2">5.1.2 Velocity</a></li>
              <li><a href="#5.1.3">5.1.3 Pitch</a></li>
              <li><a href="#5.1.4">5.1.4 Additional Parameters</a></li>
          </ul></li>
          <li><a href="#5.2">5.2 Elements, Principles, and Realizations</a></li>
          <li><a href="#5.3">5.3 Definitions</a></li>
          <li><a href="#5.4">5.4 Special Commands</a></li>
          <li><a href="#5.5">5.5 Ranges</a></li>
          <li><a href="#5.6">5.6 Multivalues</a></li>
          <li><a href="#5.7">5.7 Sections</a></li>
          <li><a href="#5.8">5.8 Conditional Multivalues</a></li>
          <li><a href="#5.9">5.9 Polymorphic Operators</a>
            <ul class="no-bullet">
              <li><a href="#5.9.1">5.9.1 Addition</a></li>
              <li><a href="#5.9.2">5.9.2 Multiplication</a></li>
              <li><a href="#5.9.3">5.9.3 Repetition</a></li>
              <li><a href="#5.9.4">5.9.4 Rotation</a></li>
              <li><a href="#5.9.5">5.9.5 Reverse</a></li>
          </ul></li>
      </ul></li>
      <li><a href="#6">6 Final Notes</a></li>
    </ul>
    <h2 id="1">1 What is MIDA?</h2>
    <p>MIDA is a minimalistic language for algorithmic generation of MIDI
      files. MIDA is not interactive in sense that you cannot control result
      of its activity in real time, it is intended for producers and should
      be used with a DAW. MIDA can help you create variative elements in
      your music in a very simple way. Since MIDI can control a lot of
      different instruments, power of MIDA is truly great.</p>
    <p>Main reason for MIDA development is to create software tool that can
      be used in such a way that does not change established workflow, so
      people could use familiar plugins and software instruments.</p>
    <p>Manual Copyright &copy; 2014 Mark Karpov.</p>
    <p>MIDA Copyright &copy; 2014 Mark Karpov.</p>
    <p>All contents here is copyright by the developer and is released under
      the <a href="http://www.gnu.org/copyleft/fdl.html"> GNU Free
      Documentation License</a>.</p>
    <p>MIDA is licensed
      under <a href="http://www.gnu.org/copyleft/gpl.html">GNU General
      Public License v.3</a>; it's free software.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h2 id="2">2 Installation</h2>
    <p>It's absolutely possible to install MIDA on any platform on
      which <a href="https://www.haskell.org/platform/">Haskell Platform</a>
      is supported. However, there are some precompiled options that may be
      more convenient and straightforward for some people. In particular, I
      propose installer for Windows users and self-extracting script for
      GNU/Linux users. To install MIDA on other platforms see
      section <a href="2.3">2.3 Compilation from Source</a>.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="2.1">2.1 Windows</h3>
    <p>To install MIDA on
      Windows <a href="https://github.com/mrkkrp/mida/releases">download
      MIDA installer</a>, then run it. To uninstall MIDA, run
      uninstaller.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="2.2">2.2 GNU/Linux</h3>
    <p><a href="https://github.com/mrkkrp/mida/releases">Download
      self-extracting script</a> and run it as root. To uninstall MIDA
      execute:</p>
    <pre># midarm</pre>
    <p>The script will remove MIDA from your system.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="2.3">2.3 Compilation from Source</h3>
    <p>First, install <a href="https://www.haskell.org/platform/">Haskell
      Platform</a>. You also need to
      install <a href="http://www.haskell.org/cabal/">Cabal</a>. After that,
      download or clone <a href="https://github.com/mrkkrp/mida">MIDA
        repository</a>:</p>
    <pre>$ git clone https://github.com/mrkkrp/mida.git master</pre>
    <p>Usually you need to update list of available packages before
      compilation, so do this:</p>
    <pre>$ cabal update
$ cabal install cabal-install</pre>
    <p>Now <code>cd</code> into directory containing downloaded repository
      of MIDA and execute:</p>
    <pre>$ cabal configure
$ cabal build</pre>
    <p>It's very likely that Cabal will not compile MIDA from the first time
      so you'll need to install all dependencies that Cabal will list for
      you.</p>
    <p>After compilation you should manually copy executable
      file <code>dist/build/mida/mida</code> into some directory where your
      system can see the executable. GNU/Linux users can run the following
      script (it also copies documentation and <code>midarm</code> for
      uninstallation.):</p>
    <pre># sh install.sh</pre>
    <p>[<a href="#0">contents</a>]</p>
    <h2 id="3">3 Invocation</h2>
    <p>MIDA can work as translator from source code to MIDI files, or as
      interactive environment (interpreter) that functions much like
      REPL. If no input file is supplied, MIDA starts in interactive mode by
      default. Otherwise, one should use command line options to start MIDA
      in interactive mode.</p>
    <p>Here's the complete list of command line options:</p>
    <pre>mida [-i|--interactive] [-s|--seed SEED] [-q|--quarter TICKS]
     [-b|--beats BEATS] [-o|--output OUT] [FILE]</pre>
    <p>Let's list all available options:</p>
   <table>
      <tr><th>Option</th><th>Description</th></tr>
      <tr><td><code>-h</code>,<code>--help</code></td>
        <td>Shows information regarding invocation parameters.</td></tr>
      <tr><td><code>-i</code>,<code>--interactive</code></td>
        <td>Starts MIDA in interactive mode. This option effectively
        disables all other supplied options, because they only make sense
        in non-interactive (batch) mode.</td></tr>
      <tr><td><code>-s</code>,<code>--seed</code></td>
        <td>Sets seed for MIDI generation. You can generate identical MIDI
        files if you use the same seed. Default value
        is <code>0</code>.</td></tr>
      <tr><td><code>-q</code>,<code>--quarter</code></td>
        <td>Sets number of ticks for quarter note, default value
        is <code>24</code>.</td></tr>
      <tr><td><code>-b</code>,<code>--beats</code></td>
        <td>Sets total time of result MIDI file as number of beats (quarter
        notes), default value is <code>16</code>.</td></tr>
      <tr><td><code>-o</code>,<code>--output</code></td>
        <td>Specifies output file. Default value is built from base name of
        supplied file and extension <code>.mid</code>.</td></tr>
   </table>
    <p>[<a href="#0">contents</a>]</p>
    <h2 id="4">4 Configuration File</h2>
    <p>One can customize MIDA to some extent using configuration file. One
      should create the file in his/her home directory. This directory will
      be different on different operating systems. On GNU/Linux machines it
      would be something like <code>/home/username/.mida</code>, while
      Windows users should create the file
      in <code>C:\Users\username\.mida</code>.</p>
    <p>For now, only four parameters can be changed:</p>
      <ul>
        <li>prompt (as <code>prompt</code>);</li>
        <li>length of displayed result of evaluation
          (as <code>prvlen</code>);</li>
        <li>maximum size (as number of top-level elements) of a score
          (as <code>block</code>); this helps prevent infinite generation of
          scores that consist only of zero-time elements;</li>
        <li>preview command (as <code>prvcmd</code>).</li>
      </ul>
    <p>Syntax of <code>.mida</code> file is one of Unix configuration
      file. That is, you can use <code>#</code> for line comments,
      and <code>=</code> to assign new values (spaces before and
      after <code>=</code> are ignored).</p>
    <p>Here is complete example of <code>.mida</code> file:</p>
    <pre>#
# MIDA Configuration File
#

prompt = &quot;M> &quot;
prvlen = 20
block  = 8192 # default is 4096
prvcmd = &quot;timidity -Os&quot;</pre>
    <p>[<a href="#0">contents</a>]</p>
    <h2 id="5">5 MIDA Tutorial</h2>
    <p>Now that you know all the basic information about the interpreter, we
      can start our journey into the magic world of MIDA.</p>
    <p>MIDA is minimalistic and not very flexible or complex. In fact, it is
      so simple that any statement that has valid syntax will produce valid
      result. MIDA statement only has to pass parser, that's all. In fact,
      it's quite hard to enter invalid statement in MIDA and we'll see
      why.</p>
    <p>If you're interested in generative music, you probably know that
      there are lots of advanced programs for algorithmic composition. But
      take a look at the output of those programs. I don't mean to offend
      someone, but it's often not that impressive.</p>
    <p>What is the reason of that? Well, people who work with complicated
      tools tend to pay more attention to process than result. The more
      complicated tool you use, the more time you spend on tool
      itself. Algorithm may be really impressive, but audience just don't
      give a fuck. We're gonna use basic tools of MIDA to create super sexy
      pop stuff, that's what we need, man.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.1">5.1 Literal Values</h3>
    <p>Start the interactive environment. Now you should be looking at
      something like this:</p>
    <pre>[mark@arch ~]$ mida
-> Loading MIDA Interactive Environment v0.3.0;
mida&gt; _</pre>
    <p>You can try your powers right away. Remember, MIDA is all about
      sequences of numbers. Numbers can represent different things:</p>
    <ul>
      <li>duration;</li>
      <li>velocity;</li>
      <li>pitch;</li>
      <li>controller events;</li>
      <li>aftertouch;</li>
      <li>pitch bend.</li>
    </ul>
    <p>Let's start from how you can enter the numbers at the prompt
      and what you get as a result.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h4 id="5.1.1">5.1.1 Duration</h4>
    <p>Durations in MIDI are relative to <i>ticks per quarter note</i>
      (TPQ). TPQ is set before translation either via command line options
      or as a parameter of <code>:make</code> and <code>:prv</code>
      commands. As I said, default value is <code>24</code>, so try to work
      with this in mind.</p>
    <p>So, if quarter note is <code>24</code> ticks, whole note will
      be <code>96</code> ticks, while eight note will be <code>12</code>
      ticks, etc. You can also use any number in between creating really
      strange rhythms. Remember that you can use numbers greater
      than <code>127</code> for duration, so there is no limits.</p>
    <p>Let's enter a number:</p>
    <pre>mida&gt; 24
=> 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24...
mida&gt; _</pre>
    <p>So, we see that we can enter literal values! However, the result may
      look a bit strange, but ignore this repetitiveness for now.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h4 id="5.1.2">5.1.2 Velocity</h4>
    <p>Since MIDI format is piano-oriented, velocity in our case means
      loudness. Again, to write down velocities we use plain numbers. Valid
      values are form <code>0</code> to <code>127</code>,
      where <code>0</code> means silence, while <code>127</code> signifies
      loudest note.</p>
    <p>Although you can enter literals greater than <code>127</code>, they
      are not guaranteed to be processed correctly.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h4 id="5.1.3">5.1.3 Pitch</h4>
    <p>Sure, you can use the same plain numbers from <code>0</code>
      to <code>127</code> for pitch, but it's a bit inconvenient. MIDA knows
      some alias for that case. Since MIDA doesn't work with negative
      numbers, we use alias where octaves start
      from <code>0</code>. So <code>c0</code> corresponds
      to <code>0</code>, <code>c#0</code> to <code>1</code>, and so on: one
      semitone per number.</p>
    <p> This table may be useful:</p>
    <table>
      <tr><th rowspan="2">Octaves</th><th colspan="12">Notes</th></tr>
      <tr><th>c</th><th>c#</th><th>d</th><th>d#</th><th>e</th><th>f</th><th>f#</th><th>g</th><th>g#</th><th>a</th><th>a#</th><th>b</th></tr>
      <tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td></tr>
      <tr><th>1</th><td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td><td>21</td><td>22</td><td>23</td></tr>
      <tr><th>2</th><td>24</td><td>25</td><td>26</td><td>27</td><td>28</td><td>29</td><td>30</td><td>31</td><td>32</td><td>33</td><td>34</td><td>35</td></tr>
      <tr><th>3</th><td>36</td><td>37</td><td>38</td><td>39</td><td>40</td><td>41</td><td>42</td><td>43</td><td>44</td><td>45</td><td>46</td><td>47</td></tr>
      <tr><th>4</th><td>48</td><td>49</td><td>50</td><td>51</td><td>52</td><td>53</td><td>54</td><td>55</td><td>56</td><td>57</td><td>58</td><td>59</td></tr>
      <tr><th>5</th><td><b>60</b></td><td>61</td><td>62</td><td>63</td><td>64</td><td>65</td><td>66</td><td>67</td><td>68</td><td>69</td><td>70</td><td>71</td></tr>
      <tr><th>6</th><td>72</td><td>73</td><td>74</td><td>75</td><td>76</td><td>77</td><td>78</td><td>79</td><td>80</td><td>81</td><td>82</td><td>83</td></tr>
      <tr><th>7</th><td>84</td><td>85</td><td>86</td><td>87</td><td>88</td><td>89</td><td>90</td><td>91</td><td>92</td><td>93</td><td>94</td><td>95</td></tr>
      <tr><th>8</th><td>96</td><td>97</td><td>98</td><td>99</td><td>100</td><td>101</td><td>102</td><td>103</td><td>104</td><td>105</td><td>106</td><td>107</td></tr>
      <tr><th>9</th><td>108</td><td>109</td><td>110</td><td>111</td><td>112</td><td>113</td><td>114</td><td>115</td><td>116</td><td>117</td><td>118</td><td>119</td></tr>
      <tr><th>10</th><td>120</td><td>121</td><td>122</td><td>123</td><td>124</td><td>125</td><td>126</td><td>127</td><td colspan="4"></td></tr>
    </table>
    <p>Please note that there is no standard way to number octaves in
      MIDI. The MIDI standard only says that note with index <code>60</code>
      must be <i>Middle C</i>. We've chosen zero-based system for reasons
      that I've described earlier, some software starts numeration
      from <code>-2</code>.</p>
    <p>Enter any alias into MIDA and see for yourself that it's just like
      entering corresponding MIDI code (note that all alias are
      case-sensitive):</p>
    <pre>mida&gt; c5
=> 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60...</pre>
    <p>...and that's it! Now you can use literal values. Oh, that's
      incredible.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h4 id="5.1.4">5.1.4 Additional Parameters</h4>
    <p>Parameters like modulation, breath, aftertouch, and pitch bend are
      called <i>additional parameters</i>. In <a href="#5.3">section 5.3</a>
      I will explain why they are called so, but for now it's important to
      understand how you can use literal values to represent these
      parameters and their change in time.</p>
    <p>Additional parameters are written either as plain numbers
      from <code>0</code> to <code>127</code> or as sum of predefined
      constant called <i>modifier</i> and plain number.</p>
    <p>Numbers from <code>0</code> to <code>127</code> without modifier
      represent value that doesn't change during length of note. Modifiers
      tells MIDA to use special forms of modulation, while number that's
      added to modifier signifies intensity of such modulation.</p>
    <p>This table describes forms of modulation that exist in MIDA:</p>
    <table>
      <tr><th>Symbol</th><th>Description</th></tr>
      <tr><td><code>/</code></td><td>Ascending change for whole duration of
          note.</td></tr>
      <tr><td><code>\</code></td><td>Condescending change for whole duration
          of note.</td></tr>
      <tr><td><code>/\</code></td><td>Ascending change for first half of
          note's duration and condescending change for the second
          half.</td></tr>
      <tr><td><code>\/</code></td><td>Condescending change for first half of
          note's duration and ascending change for the second
          half.</td></tr>
    </table>
    <p>So, for example, the command <code>/\ + 127</code> represents
      ascending change of some parameter for half duration of given note and
      condescending change back to initial value for another
      half. <code>127</code> signifies maximal possible intensity of this
      modulation.</p>
    <p>Symbols <code>/</code>, <code>\</code>, <code>\/</code>,
      and <code>/\</code> represent plain numbers, you can check it in your
      REPL, but don't use 'magic numbers', because they are subject of
      change in future versions of MIDA.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.2">5.2 Elements, Principles, and Realizations</h3>
    <p>Smallest piece of composition in MIDA is called <i>element</i>. Now
      we know at least one kind of element: literal values. Realization of
      literal value is just its value. Bear with me and all the stuff will
      be clear to you.</p>
    <p>Thing we enter into interactive prompt is called <i>principle</i>. A
      principle can consist of zero or more elements. These elements may be
      separated by commas <code>,</code>. Let's try some principles:</p>
    <pre>mida&gt; 1, 2, 3
=> 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1...
mida&gt; c5 d5 e5 f5 g5 a5 b5 c6
=> 60 62 64 65 67 69 71 72 60 62 64 65 67 69 71 72...</pre>
    <p>So, we enter a principle and MIDA prints its realization. Realization
      of principle is built this way:</p>
    <ul>
      <li>system tries to simplify given principle by applying some
        operators, such as ranges or polymorphic operators;</li>
      <li>MIDA cycles elements (not their values, you'll see difference
      later), so we have now infinite collection of elements;</li>
      <li>it realizes all the elements one by one.</li>
    </ul>
    <p>Realization can be either infinite sequence of non-negative numbers
      or <code>none</code>. <code>none</code> is a special value that
      represent realization of empty principle:</p>
    <pre>mida>
=> none</pre>
    <p>In the next section we will see other roles of <code>none</code>.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.3">5.3 Definitions</h3>
    <p>I said that it's quite hard to write an incorrect statement in
      MIDA. Let's prove it. This is my attempt:</p>
    <pre>mida&gt; foo
=> none
mida&gt; asdfasdflk
=> none
mida&gt; 1 2 rere 5
=> 1 2 5 1 2 5 1 2 5 1 2 5 1 2 5 1...</pre>
    <p>So, MIDA thinks that these things are realized to <code>none</code>,
      they can be even put inside a principle without any obvious harm.</p>
    <p>The thing is that MIDA considers any alpha-numeric sequence of
      characters that does not begin with a
      number <i>definition</i>. Definition can hold a principle and default
      value of any definition is <code>none</code>. You can combine
      definitions to build really complex principles. Keep in mind that
      names of the definitions are case-sensitive.</p>
    <p>One can create definitions by putting definition name on the left
      side of equation sign <code>=</code> and a principle on the right of
      the sigh. Let's give it a go:</p>
    <pre>mida&gt; foo = 1 2 3
-> defined 'foo'
mida&gt; foo
=> 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1...
mida&gt; foo 5
=> 1 2 3 5 1 2 3 5 1 2 3 5 1 2 3 5...</pre>
    <p>It seems to work! What a magic! Remember that definitions are
      something like recipes how to create a principle, not static
      values. So we can change a definition and all other definitions which
      use it will change accordingly:</p>
    <pre>mida&gt; foo = 5 boo = 6 baz = foo boo
-> defined 'foo'
-> defined 'boo'
-> defined 'baz'
mida&gt; baz
=> 5 6 5 6 5 6 5 6 5 6 5 6 5 6 5 6...
mida&gt; boo = 10
-> defined 'boo'
mida&gt; baz
=> 5 10 5 10 5 10 5 10 5 10 5 10 5 10 5 10...</pre>
    <p>And since all possible definitions are bound to <code>none</code>, we
      can even design our principles in top-down manner, using definitions
      that we haven't defined yet!</p>
    <p>Now you're ready to create your first piece of music, but before you
      do it I should explain something about <i>top-level
      definitions</i>. These are special names that represent duration,
      velocity, pitch, and other parameters of voices. There may be up to 16
      different voices in a MIDA score.</p>
    <p>The names are as following:</p>
    <ul>
      <li><code>dur_</code> &ndash; duration;</li>
      <li><code>vel_</code> &ndash; velocity;</li>
      <li><code>pch_</code> &ndash; pitch;</li>
      <li><code>mod_</code> &ndash; modulation;</li>
      <li><code>bth_</code> &ndash; breath;</li>
      <li><code>aft_</code> &ndash; aftertouch;</li>
      <li><code>bnd_</code> &ndash; pitch bend.</li>
    </ul>
    <p>Substitute <code>_</code> with index of desired voice, valid values
      are from <code>0</code> to <code>15</code>.</p>
    <p>Let's create some music:</p>
    <pre>mida&gt; dur0 = 24
-> defined 'dur0'
mida&gt; vel0 = 70
-> defined 'vel0'
mida&gt; pch0 = c5 d5 e5 f5 g5 a5 b5
-> defined 'pch0'</pre>
    <p>It's as simple as that! Other top-level definitions hold empty
      principles, so they will be ignored. Additional parameters like
      modulation, breath, aftertouch, and pitch bend may be omitted &ndash;
      in this case there will be no corresponding events in result MIDI
      file. Use <code>:make</code> command to
      create a MIDI file:</p>
    <pre>mida&gt; :make 0 24 14
-> MIDI file saved as &quot;bar.mid&quot;.</pre>
    <p>Use any available software to hear this astonishing masterpiece (I
      use <code>timidity++</code> for testing on GNU/Linux, it's free
      software). Description of available special commands is given in the
      next section.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.4">5.4 Special Commands</h3>
    <p>MIDA has a number of useful commands that can be invoked from
      interactive environment. All the commands begin with
      colon <code>:</code> and are case-sensitive. Let's examine them.</p>
    <h6>:help</h6>
    <p>Let's start with <code>:help</code>, this command prints list of all
      available commands and their descriptions:</p>
    <pre>mida&gt; :help
Available commands:
  :block                   Set size of block
  :def                     Print definition of given symbol
  :help                    Show this help text
  :license                 Show license
  :load                    Load definitions from given file.
  :make                    Generate and save MIDI file
  :prv                     Listen to score using external program
  :prvlen                  Set length of displayed results
  :prompt                  Set MIDA prompt
  :purge                   Remove redundant definitions
  :quit                    Quit the interactive environment
  :save                    Save current environment in file</pre>
    <h6>:license</h6>
    <p>MIDA is distributed under GNU GPL v.3, it means that the program
      <a href="http://www.gnu.org/philosophy/free-sw.html">respects your
      freedom</a>:</p>
    <pre>mida&gt; :license 
=> MIDA - realization of MIDA, language for generation of MIDI files.
=> Copyright (c) 2014 Mark Karpov
=> 
=> This program is free software: you can redistribute it and/or modify
=> it under the terms of the GNU General Public License as published by
=> the Free Software Foundation, either version 3 of the License, or
=> (at your option) any later version.
=> 
=> This program is distributed in the hope that it will be useful,
=> but WITHOUT ANY WARRANTY; without even the implied warranty of
=> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
=> GNU General Public License for more details.
=> 
=> You should have received a copy of the GNU General Public License
=> along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</pre>
    <h6>:prompt</h6>
    <p>You can temporarily change MIDA prompt with <code>:prompt</code>
      command:</p>
    <pre>mida&gt; :prompt boom>
boom> _</pre>
    <h6>:prvlen</h6>
    <p>You can also set how many elements of realized principle will be
      displayed:</p>
    <pre>mida&gt; 1
=> 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1...
mida&gt; :prvlen 20
mida&gt; 1
=> 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1...</pre>
    <h6>:block</h6>
    <p>You can set maximum size (number of top-level elements) of MIDA
      principle. If you want to create something really long and MIDA
      generates only part of it, increase this value, default
      is <code>4096</code>.</p>
    <pre>mida&gt; :block 10000</pre>
    <h6>:def</h6>
    <p>It's possible to see any definition by its name
      with <code>:def</code> command:</p>
    <pre>mida&gt; foo = 12
-> defined 'foo'
mida&gt; :def foo
=> foo = 12
mida&gt; :def bar
=> cannot find the definition</pre>
    <h6>:purge</h6>
    <p>You can 'purge' all useless definitions from memory
      using <code>:purge</code> command. A definition is considered useless
      if it's not used as a part of a top-level definition. Here's an
      example:</p>
    <pre>mida&gt; foo = bar bar = 12 baz = 13 dur0 = foo
-> defined 'foo'
-> defined 'bar'
-> defined 'baz'
-> defined 'dur0'
mida&gt; :def baz
=> baz = 13
mida&gt; :purge
-> environment purged;
mida&gt; :def baz
=> cannot find the definition</pre>
    <p>What happened here? Well, we see that <code>dur0</code> is a top
      level definition. <code>foo</code> is used in <code>dur0</code>'s
      principle and <code>bar</code> is used in <code>foo</code>'s
      principle. So, <code>foo</code> and <code>bar</code> are necessary
      definitions. What's about <code>baz</code>? It does not participate in
      principle building for any top-level definition. System considers it
      useless, so it purges it.</p>
    <h6>:load</h6>
    <p>This command allows instantly load all definitions from specified
      source file. It takes one parameter &ndash; name of the file. If no
      parameters given, default file name will be used that's not what you
      want in most cases.</p>
    <pre>mida> :load ~/test.da
-> &quot;/home/mark/test.da&quot; loaded successfully;</pre>
    <h6>:save</h6>
    <p>As you compose music with MIDA, you will need to save all existing
      definitions to hard disk. You can then edit them as a normal file or
      load it into MIDA to continue your work. It's quite easy to accomplish
      with <code>:save</code> command. This command takes an optional
      argument &ndash; file name. If you don't supply the file name, system
      will try to guess it. It will be file name of loaded source file, last
      used file name, or default value <code>bar.da</code>. I
      recommend <code>.da</code> as file name extension for MIDA source
      files.</p>
    <pre>mida&gt; :save
-> environment saved as &quot;bar.da&quot;.
mida&gt; :save boo.da
-> environment saved as &quot;boo.da&quot;.
mida&gt; :save
-> environment saved as &quot;boo.da&quot;.</pre>
    <h6>:make</h6>
    <p>One of the most useful commands is <code>:make</code>. It creates
      MIDI file based on current state of MIDA environment. This command
      takes up to four arguments. If you don't supply any of them,
      corresponding default value will be used.</p>
    <p>First argument is <i>seed</i> for random generator. We work with
      seeds because they allow to generate identical scores for identical
      seeds (it's useful sometimes). Default value of this argument
      is <code>0</code>.</p>
    <p>Second argument is number of <i>ticks per quarter note</i>. This
      value allows to convert abstract numbers that represent durations into
      conventional notes. Default value is <code>24</code>, and usually you
      don't want to change it unless you're working with extremely complex
      rhythms.</p>
    <p>Third argument is total length of composition as number of quarter
      notes. This parameter is also known as 'beats'. Default value
      is <code>16</code>.</p>
    <p>The last parameter is file name of MIDI file. If it's not supplied
      system will try to guess the name. Guessing algorithm is the same as
      for <code>:save</code> command but extension will be replaced
      with <code>.mid</code>.</p>
    <p>See the stuff in action:</p>
    <pre>mida&gt; :make 0 24 16
-> MIDI file saved as &quot;boo.mid&quot;.</pre>
    <h6>:prv</h6>
    <p>Starting with MIDA 0.3.0 there is command to preview your score
      interactively. To use this command you need to install program that
      can generate sound from MIDI files and has command line
      interface. Next, you need to create or edit <code>.mida</code> file in
      your home directory. Add parameter <code>prvcmd</code>:</p>
    <pre>prvcmd = &quot;timidity -Os&quot;</pre>
    <p>In this example I use <code>timidity++</code>. Name of temporary MIDI
      file will be appended to this string and the command will be
      executed. Timidity is a useful tool for this sort of testing because
      it provides some console output and playing can be interrupted
      with <code>Ctrl-C</code> command (on Unix systems).</p>
    <p><code>:prv</code> command takes three arguments similar to those
      of <code>:make</code>: seed, ticks per quarter note, and total
      length.</p>
    <h6>:quit</h6>
    <p>Don't forget that you quit MIDA environment
      with <code>:quit</code> command!</p>
    <pre>mida&gt; :quit
-> Goodbye.</pre>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.5">5.5 Ranges</h3>
    <p>Now that you know all the basics, we can talk about advanced methods
      of element manipulation. Simplest such a method is range. Range in
      MIDA is written as two numbers (or note alias) separated by two
      commas <code>..</code> (without space between them). Range notation
      represents collection of successive natural numbers from left-side
      number to right-side number inclusively.</p>
    <pre>mida&gt; 1..3
=> 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1...
mida&gt; 5..2
=> 5 4 3 2 5 4 3 2 5 4 3 2 5 4 3 2...
mida&gt; c5..e5
=> 60 61 62 63 64 60 61 62 63 64 60 61 62 63 64 60...</pre>
    <p>Although you cannot specify step between resulting elements, you can
      add a number to all elements of a principle or multiply all the
      elements by given number. How? Keep reading!</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.6">5.6 Multivalues</h3>
    <p>So far, we worked only with literal values. But MIDA knows one more
      kind of element: <i>multivalue</i>. Multivalue is such an element that
      has many values at the same time. You know, just like electron exists
      in different positions around atomic nucleus. Realization of
      multivalue is a random value chosen from all possible variants.</p>
    <p>Multivalue is written as collection of possible values inside
      of braces:</p>
    <pre>mida&gt; {1 2 3}
=> 3 1 3 2 1 2 2 1 1 1 3 2 2 1 1 2...</pre>
    <p>As you can see, the same element is replicated, but its realized
      value is different for every instance. Here we have uniform
      distribution, but you can change it with help of repetition:</p>
    <pre>mida&gt; {1 1 2 3} // 1 - 50%, 2 - 25%, 3 - 25%
=> 1 1 1 3 1 3 1 3 2 1 3 1 3 1 1 1...
mida&gt; {1 $ 8, 2 3} // 1 - 80%, 2 - 10%, 3 - 10%
=> 1 1 1 1 1 2 1 1 1 1 2 1 3 1 1 1...</pre>
    <p>Basic operations work together! You can put a multivalue into another
      multivalue too:</p>
    <pre>mida&gt; {1 {2 3}} // 1 - 50%, 2 - 25%, 3 - 25%
=> 1 1 1 2 2 1 1 1 2 1 1 1 3 1 1 2...</pre>
    <p><code>1</code> has probability 50%, and <code>{2 3}</code> has
      probability 50%. Inside <code>{2 3}</code> every element has equal
      probability 50%, so result probabilities look like: <code>1</code> -
      50%, <code>2</code> - 25%, <code>3</code> - 25%.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.7">5.7 Sections</h3>
    <p><i>Section</i> is another kind of element. Section is collection of
      elements that can be manipulated as one element.</p>
    <p>Sections are represented as a principle inside of square brackets
      (<code>[</code> and <code>]</code>):</p>
    <pre>mida&gt; [1 2 3]
=> 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1...</pre>
    <p>Typical example of their use is in juxtaposition with
      multivalues. With help of sections you can easily include sequence of
      elements as part of multivalue:</p>
    <pre>mida&gt; {1 2 [3..5]}
=> 1 3 4 5 2 2 1 3 4 5 1 1 3 4 5 3...</pre>
    <p>So here we have <code>1</code> with
      probability <code>1/3</code>, <code>2</code> with
      probability <code>1/3</code> and <code>3 4 5</code> with the same
      probability. We could use multivalues in the section too to get
      arbitrary complex structures.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.8">5.8 Conditional Multivalues</h3>
    <p>One step forward is <i>conditional multivalues</i>. These are just
      like multivalues, but they depend on realized value of previous
      element. For every value of previous element it provides collection of
      possible results. If there is no such a collection, random collection
      will be selected from all existing collections. If first element of a
      sequence is conditional multivalue, actual multivalue (collection)
      will be chosen randomly.</p>
    <p>This example demonstrates syntax of conditional multivalue and its
      logic:</p>
    <pre>mida&gt; {(1) 2 3 (2) 3 (3) 1}
=> 3 1 3 1 2 3 1 2 3 1 2 3 1 3 1 3...</pre>
    <p>If the last element has value <code>1</code>, conditional multivalue
      will have value <code>2</code> or <code>3</code>. If the last element
      has value <code>2</code>, conditional multivalue will have
      value <code>3</code> for sure, and so on.</p>
    <p>Conditions are checked from left to right, first matched condition
      triggers realization of one of corresponding elements.</p>
    <p>Starting with MIDA 0.2.0 it's also possible to use multiple
      conditional elements:</p>
    <pre>mida&gt; {(1 2) 3 (3) 1 2}
=> 1 3 1 3 2 3 2 3 1 3 2 3 1 3 2 3...</pre>
    <p>You can use sections to match not only the last element, but sequence
      of elements:</p>
    <pre>mida&gt; {([1 2 3]) 4 (1..4) 1..3}
=> 1 1 2 3 4 1 1 3 1 1 3 2 3 3 1 1...</pre>
    <p>Here, <code>1 2 3</code> triggers <code>4</code> while any other
      single element triggers <code>1</code>, <code>2</code>,
      or <code>3</code>.</p>
    <p>You can use multivalues in conditional clauses as sort of 'or'
      operator, consider this example:</p>
    <pre>mida&gt; {([1 {2 3}]) 7 (1..7) 1..6}
=> 7 1 1 6 1 1 2 7 1 1 4 1 3 7 3 4 5 5 1 3 7 6 5 1 4 2 5 1 1 2 7 1 4 6 2 1...</pre>
    <p>Here our first condition says 'if last but one realized element
      is <code>1</code> and after it goes <code>2</code> or <code>3</code>,
      result will be <code>7</code>'.</p>
    <p>As always, you can use conditional multivalues inside of any part of
      other conditional multivalues, but sometimes such complex structures
      are difficult to understand for human reader.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9">5.9 Polymorphic Operators</h3>
    <p>Now you know about all basic elements in MIDA. There are a number of
      operations that can be performed on these elements. You can combine
      all kinds of elements and the operators will behave differently
      according to types of their operands. Thus, we call the
      operators <i>polymorphic</i>.</p>
    <p>All operators in MIDA are infix (or prefix if unary) and left
      associative.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9.1">5.9.1 Addition</h3>
    <p>For addition we use the plus operator <code>+</code>:</p>
    <pre>mida&gt; 2 + 12
=> 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14...</pre>
    <p>So two literal values are added. Let's see other examples:</p>
    <pre>mida&gt; [1 2 3] + 10      // [11 12 13]
=> 11 12 13 11 12 13 11 12 13 11 12 13 11 12 13 11...
mida&gt; [1 2 3] + [0 1]   // [1 + 0, 2 + 1, 3 + 0]
=> 1 3 3 1 3 3 1 3 3 1 3 3 1 3 3 1...
mida&gt; [1 2 3] + {1 2}   // {[2 3 4] [3 4 5]}
=> 2 3 4 3 4 5 2 3 4 2 3 4 2 3 4 3...
mida&gt; {(1) 2 (2) 1} + 5 // {(6) 7 (7) 6}
=> 7 6 7 6 7 6 7 6 7 6 7 6 7 6 7 6...
mida> {/, \, /\, \/} + 127 // randomly selecting form of modulation
=> 639 383 383 511 383 383 255 255 511 383 255 255 383 383 511 383...</pre>
    <p>General principle: literal values affect every subelement, sections
      are cycled and their elements at corresponding indexes are applied to
      elements of another section; multivalues introduce non-determinism
      with result being multivalue that has all possible results in it;
      every part of conditional multivalue is processed according to these
      rules.</p>
    <p>Addition in MIDA is a commutative operation.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9.2">5.9.2 Multiplication</h3>
    <p>Multiplication is done in similar fashion. Use
      asterisk <code>*</code> to multiply a principle by a given number:</p>
    <pre>mida&gt; [1..3] * 2
=> 2 4 6 2 4 6 2 4 6 2 4 6 2 4 6 2...</pre>
    <p>You can combine different operations easily, all operators have the
      same precedence (except for unary):</p>
    <pre>mida&gt; [1..3] + 10 * 2
=> 22 24 26 22 24 26 22 24 26 22 24 26 22 24 26 22...</pre>
    <p>Multiplication in MIDA is also a commutative operation.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9.3">5.9.3 Repetition</h3>
    <p>Operator for repetition is <code>$</code>. Principles of evaluation
      are generally the same:</p>
    <pre>mida&gt; 1 $ 3, 10
=> 1 1 1 10 1 1 1 10 1 1 1 10 1 1 1 10...
mida&gt; {1 2} $ 3, 10
=> 1 1 1 10 1 1 2 10 1 2 2 10 2 2 1 10...
mida&gt; [1..3] $ 3, 10
=> 1 2 3 1 2 3 1 2 3 10 1 2 3 1 2 3...
mida&gt; 1 $ {2 3}, 10
=> 1 1 10 1 1 1 10 1 1 10 1 1 1 10 1 1...
mida&gt; [1 2 3] $ [2 3], 10
=> 1 1 2 2 2 3 3 10 1 1 2 2 2 3 3 10...</pre>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9.4">5.9.4 Rotation</h3>
    <p>You also can 'rotate' a principle with caret <code>^</code> operator,
      removing its former elements that will appear at the end of the
      principle:</p>
    <pre>mida&gt; [1 2 3] ^ 1
=> 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1 2...
mida&gt; [1 2 3] ^ {1 2}
=> 3 1 2 2 3 1 2 3 1 3 1 2 2 3 1 3...
mida&gt; [[1 2 3] $ 3] ^ [0 2 1]
=> 1 2 3 3 1 2 2 3 1 1 2 3 3 1 2 2...</pre>
    <p>This is so-called left rotation, but you can emulate
      right-rotation too knowing length of given principle. Note that
      rotation only makes sense applied to sections.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="5.9.5">5.9.5 Reverse</h3>
    <p>Reverse is the single unary operator in MIDA. It has the highest
      precedence, it means that it is evaluated before all other
      operators:</p>
    <pre>mida&gt; @[1 2 3]
=> 3 2 1 3 2 1 3 2 1 3 2 1 3 2 1 3...
mida&gt; @{[1 2] [3 4]}
=> 4 3 4 3 2 1 4 3 4 3 4 3 4 3 4 3...</pre>
    <p>As always, arbitrary complex elements can be reversed.</p>
    <p>[<a href="#0">contents</a>]</p>
    <h3 id="6">6 Final Notes</h3>
    <p>It's allowed to put comments in MIDA source files or in interactive
      environment. MIDA uses C-like comments. Line comments starts
      with <code>//</code>, block comment starts with <code>/*</code> and
      ends with <code>*/</code>.</p>
    <p>Interpreter supports multiline input. It automatically detects
      unbalanced parenthesis, braces, brackets. If you want to continue
      writing a principle on the next line, end current line with a
      comma <code>,</code>. Since comma is allowed only between elements of
      a principle MIDA will know that current principle is not
      completed.</p>
    <p>I sincerely hope that MIDA will be useful to you. Good luck!</p>
    <p>[<a href="#0">contents</a>]</p>
  </body>
</html>
